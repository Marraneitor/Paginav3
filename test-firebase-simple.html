<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Firebase Simple - SR & SRA Burger</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto p-6">
        <h1 class="text-3xl font-bold text-center mb-8">üß™ Test Firebase Simple</h1>
        
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4">üìä Estado de Conexi√≥n</h2>
            <div id="status" class="text-gray-600">Iniciando...</div>
        </div>

        <div class="bg-black rounded-lg p-4">
            <h3 class="text-white font-bold mb-2">üìù Console Logs</h3>
            <div id="console-logs" class="text-green-400 font-mono text-sm max-h-48 overflow-y-auto">
                <p>Logs aparecer√°n aqu√≠...</p>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // Import Firebase functions
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            doc,
            setDoc,
            getDoc,
            onSnapshot
        } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyCf7-6oLHjpNgU1zr4qdTrOKuXGe1ht2Zs",
            authDomain: "sr-sra-burger.firebaseapp.com",
            projectId: "sr-sra-burger",
            storageBucket: "sr-sra-burger.firebasestorage.app",
            messagingSenderId: "542059080203",
            appId: "1:542059080203:web:2e15f179a1475b1a77f50e"
        };

        // Console logging to page
        const logsContainer = document.getElementById('console-logs');
        const statusElement = document.getElementById('status');
        
        function addLog(message, type = 'log') {
            const logEntry = document.createElement('div');
            logEntry.className = type === 'error' ? 'text-red-400' : 'text-green-400';
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;
            console[type](message);
        }
        
        function updateStatus(message, isError = false) {
            statusElement.innerHTML = isError ? 
                `üî¥ <strong>Error:</strong> ${message}` : 
                `üü¢ <strong>√âxito:</strong> ${message}`;
        }

        // Test Firebase connection
        async function testFirebase() {
            try {
                addLog('Iniciando Firebase...');
                
                // Initialize Firebase
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                addLog('Firebase inicializado correctamente');
                
                // Test write to settings
                addLog('Probando escritura en Firebase...');
                const settingsRef = doc(db, 'settings', 'admin');
                const testData = {
                    serviceActive: true,
                    hiddenProducts: [],
                    lastUpdate: new Date().toISOString(),
                    testConnection: true
                };
                
                await setDoc(settingsRef, testData);
                addLog('‚úÖ Escritura exitosa en Firebase');
                
                // Test read from settings
                addLog('Probando lectura desde Firebase...');
                const docSnap = await getDoc(settingsRef);
                
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    addLog('‚úÖ Lectura exitosa desde Firebase');
                    addLog(`Datos le√≠dos: ${JSON.stringify(data, null, 2)}`);
                    updateStatus('Conexi√≥n exitosa - Firebase funcionando correctamente');
                } else {
                    addLog('‚ùå No se encontr√≥ el documento');
                    updateStatus('Error: Documento no encontrado', true);
                }
                
                // Test real-time listener
                addLog('Configurando listener en tiempo real...');
                onSnapshot(settingsRef, (doc) => {
                    if (doc.exists()) {
                        const data = doc.data();
                        addLog(`üì° Actualizaci√≥n en tiempo real: ${JSON.stringify(data)}`);
                    }
                });
                addLog('‚úÖ Listener configurado correctamente');
                
            } catch (error) {
                addLog(`‚ùå Error: ${error.message}`, 'error');
                updateStatus(`Error de conexi√≥n: ${error.message}`, true);
            }
        }

        // Start test when page loads
        document.addEventListener('DOMContentLoaded', () => {
            addLog('P√°gina cargada, iniciando test...');
            testFirebase();
        });
    </script>
</body>
</html>
