<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnóstico Firebase Simple</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .resultado { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            font-weight: bold; 
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        pre { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            overflow-x: auto; 
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>🔥 Diagnóstico Firebase Simple</h1>
    
    <div id="resultado" class="resultado info">
        🔄 Iniciando diagnóstico...
    </div>
    
    <h3>📊 Log de Diagnóstico:</h3>
    <pre id="log"></pre>

    <script type="module">
        const log = document.getElementById('log');
        const resultado = document.getElementById('resultado');
        
        function escribirLog(mensaje) {
            log.textContent += new Date().toLocaleTimeString() + ': ' + mensaje + '\n';
            console.log(mensaje);
        }

        function actualizarResultado(mensaje, tipo) {
            resultado.className = `resultado ${tipo}`;
            resultado.textContent = mensaje;
        }

        escribirLog('🚀 Iniciando diagnóstico Firebase...');

        try {
            // Paso 1: Verificar importación de Firebase
            escribirLog('📦 Importando Firebase modules...');
            
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js");
            const { getFirestore, connectFirestoreEmulator, collection, addDoc } = await import("https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js");
            
            escribirLog('✅ Módulos de Firebase importados correctamente');

            // Paso 2: Configuración
            escribirLog('⚙️ Configurando Firebase...');
            
            const firebaseConfig = {
                apiKey: "AIzaSyCf7-6oLHjpNgU1zr4qdTrOKuXGe1ht2Zs",
                authDomain: "sr-sra-burger.firebaseapp.com",
                projectId: "sr-sra-burger",
                storageBucket: "sr-sra-burger.firebasestorage.app",
                messagingSenderId: "542059080203",
                appId: "1:542059080203:web:2e15f179a1475b1a77f50e"
            };

            escribirLog('🔧 Configuración cargada: ' + JSON.stringify(firebaseConfig, null, 2));

            // Paso 3: Inicializar Firebase
            escribirLog('🔥 Inicializando Firebase App...');
            const app = initializeApp(firebaseConfig);
            escribirLog('✅ Firebase App inicializada');

            // Paso 4: Inicializar Firestore
            escribirLog('💾 Inicializando Firestore...');
            const db = getFirestore(app);
            escribirLog('✅ Firestore inicializado');

            // Paso 5: Probar escritura
            escribirLog('📝 Probando escritura en Firestore...');
            
            const testData = {
                test: true,
                timestamp: new Date(),
                message: 'Prueba de conexión Firebase'
            };

            const docRef = await addDoc(collection(db, 'test'), testData);
            escribirLog('✅ Documento creado con ID: ' + docRef.id);

            actualizarResultado('🎉 ¡Firebase funcionando perfectamente!', 'success');
            escribirLog('🎯 RESULTADO: Todo funciona correctamente');

        } catch (error) {
            escribirLog('❌ ERROR: ' + error.message);
            escribirLog('📋 Stack trace: ' + error.stack);
            
            actualizarResultado('❌ Error: ' + error.message, 'error');
            
            // Diagnóstico específico del error
            if (error.message.includes('Missing or insufficient permissions')) {
                escribirLog('🔐 PROBLEMA: Reglas de Firestore no configuradas');
                escribirLog('💡 SOLUCIÓN: Configura las reglas en Firebase Console');
            } else if (error.message.includes('Failed to get document')) {
                escribirLog('🌐 PROBLEMA: Error de conectividad');
                escribirLog('💡 SOLUCIÓN: Verificar conexión a internet');
            } else if (error.message.includes('API key not valid')) {
                escribirLog('🔑 PROBLEMA: API Key inválida');
                escribirLog('💡 SOLUCIÓN: Verificar configuración de Firebase');
            }
        }
    </script>
</body>
</html>
