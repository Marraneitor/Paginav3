<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DiagnÃ³stico Firebase Simple</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #f5f5f5; 
        }
        .resultado { 
            padding: 15px; 
            margin: 10px 0; 
            border-radius: 5px; 
            font-weight: bold; 
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        pre { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 5px; 
            overflow-x: auto; 
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¥ DiagnÃ³stico Firebase Simple</h1>
    
    <div id="resultado" class="resultado info">
        ğŸ”„ Iniciando diagnÃ³stico...
    </div>
    
    <h3>ğŸ“Š Log de DiagnÃ³stico:</h3>
    <pre id="log"></pre>

    <script type="module">
        const log = document.getElementById('log');
        const resultado = document.getElementById('resultado');
        
        function escribirLog(mensaje) {
            log.textContent += new Date().toLocaleTimeString() + ': ' + mensaje + '\n';
            console.log(mensaje);
        }

        function actualizarResultado(mensaje, tipo) {
            resultado.className = `resultado ${tipo}`;
            resultado.textContent = mensaje;
        }

        escribirLog('ğŸš€ Iniciando diagnÃ³stico Firebase...');

        try {
            // Paso 1: Verificar importaciÃ³n de Firebase
            escribirLog('ğŸ“¦ Importando Firebase modules...');
            
            const { initializeApp } = await import("https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js");
            const { getFirestore, connectFirestoreEmulator, collection, addDoc } = await import("https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js");
            
            escribirLog('âœ… MÃ³dulos de Firebase importados correctamente');

            // Paso 2: ConfiguraciÃ³n
            escribirLog('âš™ï¸ Configurando Firebase...');
            
            const firebaseConfig = {
                apiKey: "AIzaSyCf7-6oLHjpNgU1zr4qdTrOKuXGe1ht2Zs",
                authDomain: "sr-sra-burger.firebaseapp.com",
                projectId: "sr-sra-burger",
                storageBucket: "sr-sra-burger.firebasestorage.app",
                messagingSenderId: "542059080203",
                appId: "1:542059080203:web:2e15f179a1475b1a77f50e"
            };

            escribirLog('ğŸ”§ ConfiguraciÃ³n cargada: ' + JSON.stringify(firebaseConfig, null, 2));

            // Paso 3: Inicializar Firebase
            escribirLog('ğŸ”¥ Inicializando Firebase App...');
            const app = initializeApp(firebaseConfig);
            escribirLog('âœ… Firebase App inicializada');

            // Paso 4: Inicializar Firestore
            escribirLog('ğŸ’¾ Inicializando Firestore...');
            const db = getFirestore(app);
            escribirLog('âœ… Firestore inicializado');

            // Paso 5: Probar escritura
            escribirLog('ğŸ“ Probando escritura en Firestore...');
            
            const testData = {
                test: true,
                timestamp: new Date(),
                message: 'Prueba de conexiÃ³n Firebase'
            };

            const docRef = await addDoc(collection(db, 'test'), testData);
            escribirLog('âœ… Documento creado con ID: ' + docRef.id);

            actualizarResultado('ğŸ‰ Â¡Firebase funcionando perfectamente!', 'success');
            escribirLog('ğŸ¯ RESULTADO: Todo funciona correctamente');

        } catch (error) {
            escribirLog('âŒ ERROR: ' + error.message);
            escribirLog('ğŸ“‹ Stack trace: ' + error.stack);
            
            actualizarResultado('âŒ Error: ' + error.message, 'error');
            
            // DiagnÃ³stico especÃ­fico del error
            if (error.message.includes('Missing or insufficient permissions')) {
                escribirLog('ğŸ” PROBLEMA: Reglas de Firestore no configuradas');
                escribirLog('ğŸ’¡ SOLUCIÃ“N: Configura las reglas en Firebase Console');
            } else if (error.message.includes('Failed to get document')) {
                escribirLog('ğŸŒ PROBLEMA: Error de conectividad');
                escribirLog('ğŸ’¡ SOLUCIÃ“N: Verificar conexiÃ³n a internet');
            } else if (error.message.includes('API key not valid')) {
                escribirLog('ğŸ”‘ PROBLEMA: API Key invÃ¡lida');
                escribirLog('ğŸ’¡ SOLUCIÃ“N: Verificar configuraciÃ³n de Firebase');
            }
        }
    </script>
</body>
</html>
